<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Reservas</title>

<link rel="stylesheet"
href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

<style>
body {
    background: #f3f4f6;
    font-family: "Segoe UI", sans-serif;
}

.card-box {
    background: white;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    margin-bottom: 20px;
}

.reserva-item {
    background: white;
    padding: 12px;
    border-radius: 12px;
    box-shadow: 0 1px 6px rgba(0,0,0,0.08);
    margin-bottom: 12px;
}
</style>
</head>

<body>

<div class="container mt-3">

    <button class="btn btn-secondary mb-3" onclick="location.href='index.html'">⬅ Volver</button>

    <h3 class="text-center mb-3">Reservas</h3>

    <!-- FORM de reserva -->
    <div class="card-box">
        <h5>Nueva reserva</h5>

        <label class="mt-2">Espacio</label>
        <select id="espacio" class="form-control">
            <option value="SUM">SUM</option>
            <option value="Parrilla">Parrilla</option>
            <option value="Cowork">Cowork</option>
            <option value="Cancha">Cancha</option>
        </select>

        <label class="mt-3">Fecha</label>
        <input type="date" id="fecha" class="form-control">

        <label class="mt-3">Horario</label>
        <select id="horario" class="form-control">
            <option value="09:00">09:00</option>
            <option value="10:00">10:00</option>
            <option value="11:00">11:00</option>
            <option value="12:00">12:00</option>
            <option value="13:00">13:00</option>
            <option value="14:00">14:00</option>
            <option value="15:00">15:00</option>
            <option value="16:00">16:00</option>
            <option value="17:00">17:00</option>
            <option value="18:00">18:00</option>
            <option value="19:00">19:00</option>
            <option value="20:00">20:00</option>
        </select>

        <button class="btn btn-primary w-100 mt-3" onclick="hacerReserva()">Reservar</button>

        <p id="msg" class="mt-3"></p>
    </div>

    <!-- MIS RESERVAS -->
    <div class="card-box">
        <h5>Mis reservas</h5>

        <button class="btn btn-info w-100 mb-3" onclick="cargarReservas()">Actualizar</button>

        <div id="listaReservas"></div>
    </div>

</div>

<script>
// Crear reserva
async function hacerReserva() {
    const espacio = document.getElementById("espacio").value;
    const fecha = document.getElementById("fecha").value;
    const horario = document.getElementById("horario").value;

    const resp = await fetch("http://localhost:3000/api/reservas", {
        method: "POST",
        credentials: "include",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ espacio, fecha, horario })
    });

    const data = await resp.json();
    const msg = document.getElementById("msg");

    if (!resp.ok || !data.ok) {
        msg.innerText = "❌ " + data.msg;
        msg.style.color = "red";
        return;
    }

    msg.innerText = "✔ Reserva creada";
    msg.style.color = "green";

    cargarReservas();
}

// Listar reservas
async function cargarReservas() {
    const r = await fetch("http://localhost:3000/api/reservas", {
        credentials: "include"
    });

    const reservas = await r.json();
    const cont = document.getElementById("listaReservas");
    cont.innerHTML = "";

    reservas.forEach(r => {
        cont.innerHTML += `
            <div class="reserva-item">
                <strong>${r.espacio}</strong><br>
                Fecha: ${r.fecha}<br>
                Horario: ${r.horario}<br>
                Estado: ${r.estado}<br>
                ${
                    r.estado === "activa"
                    ? `<button class="btn btn-danger btn-sm mt-2" onclick="cancelar(${r.id})">Cancelar</button>`
                    : ""
                }
            </div>
        `;
    });
}
cargarReservas();

// Cancelar
async function cancelar(id) {
    if (!confirm("¿Cancelar reserva?")) return;

    await fetch("http://localhost:3000/api/reservas/cancelar", {
        method: "POST",
        credentials: "include",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ id })
    });

    cargarReservas();
}
</script>

</body>
</html>
